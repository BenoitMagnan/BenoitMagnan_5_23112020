<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!--LIEN VERS LA POLICE DE CHARACTERES RALEWAY-->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <!---->

  <!--LIEN DE CONNEXION VERS FONTAWESOME-->
  <link rel="preconnect" href="https://fonts.gstatic.com"> 
  <script src="https://kit.fontawesome.com/637b694283.js" crossorigin="anonymous"></script>
  <script src="../javascript/javascript.js"></script>
  <!---->
  

  <link rel="stylesheet" href="../css/style.css" />
  
  <title>Orinoco - Vente en ligne</title>
</head>

<body>
  <div class="bg-primary">
    <div class="container">
      <div class="row">
        <nav class="col navbar navbar-light">
          <a class="navbar-brand" href="../index.html"><img class="mr-4" src="../logo.png"  alt="Logo d'Orinoco - Retour à la page d'acceuil" /></a>
            <ul class="navbar-nav">
              <li class="nav-item ">
                <a class="nav-link" href="panier.html"><i class="fas fa-shopping-basket"></i></a>
              </li>
            </ul>
        </nav>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="flex-row py-2 my-4 bg-primary rounded text-center ">
        <div id="cardHolder" class="col-12">
            
        </div>
    </div>
  </div>
  

  <script>
    let cardHolder = document.getElementById('cardHolder');

  
    window.addEventListener('load', () => {
        const params = (new URL(document.location)).searchParams;
        const index = params.get('index');
        const page = params.get('page');

        switch(page) {
          case 'teddies':
            fetchProduct(index, page);
            break;
          case 'cameras' :
            fetchProduct(index, page);
            break;
          case 'furniture' :
            fetchProduct(index, page);
            break;
        }
    })

    const request = new XMLHttpRequest();
  
    function fetchProduct(index, page){
        const url = 'https://jwdp5.herokuapp.com/api/' + page

        request.onreadystatechange = function(){
          if(this.readyState == XMLHttpRequest.DONE && this.status == 200){
              const response =  JSON.parse(this.responseText);
              let product;
              switch(page) {
                case 'teddies':
                  product = response[index].colors;
                  break;
                case 'cameras' :
                  product = response[index].lenses;
                  break;
                case 'furniture' :
                  product = response[index].varnish;
                break;
              }

              cardHolder.innerHTML +=
              "<div class='py-2 text-justify '>"
                  + "<div class='card h-100 shadow'>"
                  + "<div class='card-body d-flex flex-wrap'>"
                      + "<h2 id='name' class='col-12'>" + response[index].name + "</h2>"

                      + "<div class='col-md-6 img-container'>"
                        + "<img class='col-12 mx-auto my-4 d-block' src='" + response[index].imageUrl + "' alt='" + response[index].description + "'>"
                      + "</div>"

                      + "<div class='col-md-6 bg-light p-4 d-flex flex-column'>"
                        + "<p>" + response[index].description + "</p>"
                        + "<h3 id='price' class='font-weight-bold font-italic text-right mt-4'>" + response[index].price / 100 + " €</h3>"
                     
                        + "<form class='mt-4'> "
                          + "<div class='form-group d-flex flex-wrap justify-content-end'>"
                            + "<label class='col-lg-12 text-lg-right'><u>Modèles :</u></label>"
                            + "<select id='" + response[index]._id + "' class='form-control col-md-6 my-4'>"
                            + "</select>"
                          + "</div>"
                          + "<div class='form-group col-12 text-center'>"
                            + "<button id='storeData' type='submit' class='col-lg-6 btn btn-primary'>Ajouter au panier</button>"
                          + "</div>"
                          + "</form>";

                      + "</div>"
                + "</div>"
                + "</div>"
              + "</div>";

              const productChoice = document.getElementById(response[index]._id);
           
              for (i = 0; i < product.length; i++){
                productChoice.innerHTML += "<option>" + product[i] + "</option>";
              }

              
              const storeData = document.getElementById('storeData');
              
              let items = [];
              
              if (localStorage.length > 0){
                items = JSON.parse(localStorage.getItem('items'));
              }
              
              storeData.addEventListener('click', function(event){

                let object = {
                  choice: productChoice.value,
                  name: response[index].name,
                  price: response[index].price,
                  id: response[index]._id,
                  imageUrl: response[index].imageUrl
                };
                
                items.push(object);

                localStorage.setItem('items', JSON.stringify(items));

                console.log(localStorage);
                event.preventDefault();
              })
          }
        }
        request.open('GET', url);
        request.send();
        }

  </script>

</body>
</html>

    